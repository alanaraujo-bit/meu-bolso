(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[449],{21636:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});var r=t(95155);function s(e){let{text:a="Carregando",size:t="md"}=e;return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center space-y-4",children:[(0,r.jsxs)("div",{className:"".concat({sm:"w-16 h-10",md:"w-24 h-16",lg:"w-32 h-20"}[t]," relative bg-gradient-to-r from-green-100 to-green-200 rounded-lg border-2 border-green-300 shadow-lg overflow-hidden"),children:[(0,r.jsxs)("div",{className:"absolute inset-0 opacity-20",children:[(0,r.jsx)("div",{className:"w-full h-full bg-gradient-to-br from-green-200 to-green-300"}),(0,r.jsx)("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2",children:(0,r.jsx)("span",{className:"text-green-600 font-bold text-lg opacity-30",children:"R$"})}),(0,r.jsx)("div",{className:"absolute top-1 left-1 w-2 h-2 bg-green-400 rounded-full opacity-40"}),(0,r.jsx)("div",{className:"absolute top-1 right-1 w-2 h-2 bg-green-400 rounded-full opacity-40"}),(0,r.jsx)("div",{className:"absolute bottom-1 left-1 w-2 h-2 bg-green-400 rounded-full opacity-40"}),(0,r.jsx)("div",{className:"absolute bottom-1 right-1 w-2 h-2 bg-green-400 rounded-full opacity-40"})]}),(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-green-400 to-green-500 opacity-70 animate-fill-money"}),(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white to-transparent opacity-30 animate-shine"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("span",{className:"".concat({sm:"text-sm",md:"text-base",lg:"text-lg"}[t]," text-gray-600 font-medium"),children:a}),(0,r.jsxs)("div",{className:"flex space-x-1",children:[(0,r.jsx)("div",{className:"w-1 h-1 bg-green-500 rounded-full animate-bounce"}),(0,r.jsx)("div",{className:"w-1 h-1 bg-green-500 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,r.jsx)("div",{className:"w-1 h-1 bg-green-500 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})]})]})}t(12115)},59287:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>c});var r=t(95155),s=t(12115),o=t(12108),n=t(35695),i=t(21636);function c(){let{data:e,status:a}=(0,o.useSession)(),t=(0,n.useRouter)(),[c,l]=(0,s.useState)([]),[d,u]=(0,s.useState)([]),[x,m]=(0,s.useState)(null),[g,h]=(0,s.useState)(!0),[b,p]=(0,s.useState)(!1),[f,v]=(0,s.useState)(null),[j,y]=(0,s.useState)(""),[N,w]=(0,s.useState)("todos"),[E,k]=(0,s.useState)("todos"),[C,T]=(0,s.useState)(!1),[S,D]=(0,s.useState)({categoriaId:"",tipo:"despesa",valor:"",descricao:"",frequencia:"mensal",dataInicio:"",dataFim:"",isActive:!0});async function I(){try{let e=await fetch("/api/categorias");if(e.ok){let a=await e.json();u(a)}}catch(e){console.error("Erro ao carregar categorias:",e)}}async function A(){try{h(!0);let e=new URLSearchParams;"todos"!==N&&e.append("status",N),"todos"!==E&&e.append("tipo",E);let a=await fetch("/api/recorrentes?".concat(e));if(a.ok){let e=await a.json();l(e)}else y("Erro ao carregar transa\xe7\xf5es recorrentes")}catch(e){y("Erro ao carregar transa\xe7\xf5es recorrentes")}finally{h(!1)}}async function P(){try{let e=await fetch("/api/recorrentes/executar");if(e.ok){let a=await e.json();m(a)}}catch(e){console.error("Erro ao carregar pendentes:",e)}}async function F(e){if(e.preventDefault(),!S.categoriaId||!S.valor||!S.dataInicio)return void y("Preencha todos os campos obrigat\xf3rios");try{let e=await fetch(f?"/api/recorrentes/".concat(f):"/api/recorrentes",{method:f?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...S,dataFim:S.dataFim||null})});if(e.ok)y(f?"Transa\xe7\xe3o recorrente atualizada!":"Transa\xe7\xe3o recorrente criada!"),L(),A(),P();else{let a=await e.json();y(a.error||"Erro ao salvar transa\xe7\xe3o recorrente")}}catch(e){y("Erro ao salvar transa\xe7\xe3o recorrente")}}async function R(e){D({categoriaId:e.categoriaId,tipo:e.tipo,valor:e.valor.toString(),descricao:e.descricao||"",frequencia:e.frequencia,dataInicio:new Date(e.dataInicio).toISOString().split("T")[0],dataFim:e.dataFim?new Date(e.dataFim).toISOString().split("T")[0]:"",isActive:e.isActive}),v(e.id),p(!0)}async function q(e,a){try{let t=c.find(a=>a.id===e);if(!t)return;(await fetch("/api/recorrentes/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({...t,isActive:!a})})).ok?(y("Transa\xe7\xe3o recorrente ".concat(a?"desativada":"ativada","!")),A(),P()):y("Erro ao alterar status da transa\xe7\xe3o recorrente")}catch(e){y("Erro ao alterar status da transa\xe7\xe3o recorrente")}}async function O(e,a){if(confirm('Tem certeza que deseja excluir a transa\xe7\xe3o recorrente "'.concat(a,'"?')))try{let a=await fetch("/api/recorrentes/".concat(e),{method:"DELETE"});if(a.ok)y("Transa\xe7\xe3o recorrente exclu\xedda!"),A(),P();else{let e=await a.json();y(e.error||"Erro ao excluir transa\xe7\xe3o recorrente")}}catch(e){y("Erro ao excluir transa\xe7\xe3o recorrente")}}async function _(e,a){if(confirm('Deseja executar a transa\xe7\xe3o recorrente "'.concat(a,'"?')))try{let a=await fetch("/api/recorrentes/executar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({recorrenteId:e})});if(a.ok){let e=await a.json();y(e.message),A(),P()}else{let e=await a.json();y(e.error||"Erro ao executar transa\xe7\xe3o recorrente")}}catch(e){console.error("Erro ao executar transa\xe7\xe3o recorrente:",e),y("Erro ao executar transa\xe7\xe3o recorrente")}}async function z(){if(confirm("Deseja executar todas as transa\xe7\xf5es recorrentes pendentes?"))try{T(!0),console.log("Verificando pendentes antes da execu\xe7\xe3o...");let e=await fetch("/api/recorrentes/executar"),a=await e.json();console.log("Pendentes antes:",a);let t=await fetch("/api/recorrentes/executar",{method:"POST"});if(t.ok){let e=await t.json();console.log("Resultado da execu\xe7\xe3o:",e),y("Execu\xe7\xe3o conclu\xedda! ".concat(e.transacoesCriadas," transa\xe7\xf5es criadas.")),setTimeout(()=>{A(),P()},1e3)}else{let e=await t.json();console.error("Erro na execu\xe7\xe3o:",e),y(e.error||"Erro ao executar transa\xe7\xf5es recorrentes")}}catch(e){console.error("Erro ao executar transa\xe7\xf5es recorrentes:",e),y("Erro ao executar transa\xe7\xf5es recorrentes")}finally{T(!1)}}function L(){D({categoriaId:"",tipo:"despesa",valor:"",descricao:"",frequencia:"mensal",dataInicio:"",dataFim:"",isActive:!0}),v(null),p(!1)}function B(e){return new Date(e).toLocaleDateString("pt-BR")}async function J(){try{console.log("\uD83D\uDD0D Testando execu\xe7\xe3o...");let e=await fetch("/api/debug"),a=await e.json();console.log("\uD83D\uDCCA Dados de debug:",a);let t=await fetch("/api/recorrentes/executar",{method:"POST"}),r=await t.json();console.log("\uD83D\uDE80 Resultado da execu\xe7\xe3o:",r),y("Debug: ".concat(a.totais.recorrentes," recorrentes, ").concat(a.totais.transacoes," transa\xe7\xf5es. Execu\xe7\xe3o: ").concat(r.message))}catch(e){console.error("Erro no teste:",e),y("Erro no teste de execu\xe7\xe3o")}}return(0,s.useEffect)(()=>{if("loading"!==a&&!e)return void t.push("/login")},[e,a,t]),(0,s.useEffect)(()=>{e&&(I(),A(),P())},[e,N,E]),"loading"===a||g?(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:(0,r.jsx)(i.A,{})}):(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100",children:(0,r.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-4xl font-bold text-gray-900 mb-2",children:"Transa\xe7\xf5es Recorrentes"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Configure entradas e sa\xeddas autom\xe1ticas"})]}),(0,r.jsxs)("div",{className:"flex gap-3 mt-4 sm:mt-0",children:[x&&x.totalExecucoesPendentes>0&&(0,r.jsx)("button",{onClick:z,disabled:C,className:"bg-orange-600 text-white px-6 py-3 rounded-xl hover:bg-orange-700 transition-colors font-medium shadow-lg disabled:opacity-50",children:C?"Executando...":"Executar Pendentes (".concat(x.totalExecucoesPendentes,")")}),(0,r.jsx)("button",{onClick:()=>p(!0),className:"bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-6 py-3 rounded-xl hover:from-blue-700 hover:to-indigo-700 transition-all duration-200 font-medium shadow-lg",children:"Nova Recorrente"}),(0,r.jsx)("button",{onClick:J,className:"bg-purple-600 text-white px-6 py-3 rounded-xl hover:bg-purple-700 transition-colors font-medium shadow-lg",title:"Testar execu\xe7\xe3o (debug)",children:"Testar"})]})]}),j&&(0,r.jsxs)("div",{className:"mb-6 p-4 rounded-xl text-sm font-medium bg-blue-50 text-blue-800 border border-blue-200",children:[j,(0,r.jsx)("button",{onClick:()=>y(""),className:"ml-4 text-blue-600 hover:text-blue-800",children:"✕"})]}),x&&x.totalExecucoesPendentes>0&&(0,r.jsx)("div",{className:"mb-6 p-4 rounded-xl bg-orange-50 border border-orange-200",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold text-orange-800",children:"⚠️ Transa\xe7\xf5es Pendentes"}),(0,r.jsxs)("p",{className:"text-sm text-orange-700",children:["H\xe1 ",x.totalExecucoesPendentes," execu\xe7\xf5es pendentes de ",x.totalPendentes," transa\xe7\xf5es recorrentes."]})]}),(0,r.jsx)("button",{onClick:z,disabled:C,className:"bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition-colors text-sm font-medium disabled:opacity-50",children:C?"Executando...":"Executar Agora"})]})}),(0,r.jsx)("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-200 p-6 mb-8",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),(0,r.jsxs)("select",{value:N,onChange:e=>w(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,r.jsx)("option",{value:"todos",children:"Todos"}),(0,r.jsx)("option",{value:"ativo",children:"Ativas"}),(0,r.jsx)("option",{value:"inativo",children:"Inativas"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo"}),(0,r.jsxs)("select",{value:E,onChange:e=>k(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,r.jsx)("option",{value:"todos",children:"Todos"}),(0,r.jsx)("option",{value:"receita",children:"Receitas"}),(0,r.jsx)("option",{value:"despesa",children:"Despesas"})]})]})]})}),(0,r.jsx)("div",{className:"space-y-4",children:0===c.length?(0,r.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-200 p-12 text-center",children:[(0,r.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDD04"}),(0,r.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Nenhuma transa\xe7\xe3o recorrente encontrada"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6",children:"Configure suas primeiras entradas e sa\xeddas autom\xe1ticas"}),(0,r.jsx)("button",{onClick:()=>p(!0),className:"bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-6 py-3 rounded-xl hover:from-blue-700 hover:to-indigo-700 transition-all duration-200 font-medium",children:"Criar Primeira Recorrente"})]}):c.map(e=>{var a,t;return(0,r.jsx)("div",{className:"bg-white rounded-2xl shadow-lg border-l-4 p-6 ".concat(e.isActive?"receita"===e.tipo?"border-l-green-500":"border-l-red-500":"border-l-gray-400"),children:(0,r.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-4",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,r.jsx)("span",{className:"text-2xl",children:e.categoria.icone}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold text-gray-900",children:e.descricao||"Transa\xe7\xe3o recorrente"}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:[e.categoria.nome," • ",{diario:"Di\xe1rio",semanal:"Semanal",mensal:"Mensal",anual:"Anual"}[a=e.frequencia]||a]})]}),!e.isActive&&(0,r.jsx)("span",{className:"bg-gray-100 text-gray-600 px-2 py-1 rounded-full text-xs font-medium",children:"Inativa"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Valor:"}),(0,r.jsxs)("p",{className:"font-medium ".concat("receita"===e.tipo?"text-green-600":"text-red-600"),children:["receita"===e.tipo?"+":"-",(t=e.valor,new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"In\xedcio:"}),(0,r.jsx)("p",{className:"font-medium",children:B(e.dataInicio)})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Fim:"}),(0,r.jsx)("p",{className:"font-medium",children:e.dataFim?B(e.dataFim):"Indefinido"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Execu\xe7\xf5es:"}),(0,r.jsx)("p",{className:"font-medium",children:e._count.transacoes})]})]}),e.proximaExecucao&&(0,r.jsx)("div",{className:"mt-3 p-3 bg-blue-50 rounded-lg",children:(0,r.jsxs)("p",{className:"text-sm text-blue-700",children:[(0,r.jsx)("span",{className:"font-medium",children:"Pr\xf3xima execu\xe7\xe3o:"})," ",B(e.proximaExecucao)]})})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[e.isActive&&(null==x?void 0:x.pendentes.some(a=>a.id===e.id))&&(0,r.jsx)("button",{onClick:()=>_(e.id,e.descricao||"Transa\xe7\xe3o"),className:"bg-orange-100 text-orange-700 px-4 py-2 rounded-lg hover:bg-orange-200 transition-colors text-sm font-medium",title:"Executar agora",children:"▶ Executar"}),(0,r.jsx)("button",{onClick:()=>q(e.id,e.isActive),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors ".concat(e.isActive?"bg-gray-100 text-gray-700 hover:bg-gray-200":"bg-green-100 text-green-700 hover:bg-green-200"),children:e.isActive?"Desativar":"Ativar"}),(0,r.jsx)("button",{onClick:()=>R(e),className:"bg-blue-100 text-blue-700 px-4 py-2 rounded-lg hover:bg-blue-200 transition-colors text-sm font-medium",children:"Editar"}),(0,r.jsx)("button",{onClick:()=>O(e.id,e.descricao||"Transa\xe7\xe3o"),className:"bg-red-100 text-red-700 px-4 py-2 rounded-lg hover:bg-red-200 transition-colors text-sm font-medium",children:"Excluir"})]})]})},e.id)})}),b&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,r.jsx)("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsxs)("h2",{className:"text-2xl font-bold text-gray-900",children:[f?"Editar":"Nova"," Transa\xe7\xe3o Recorrente"]}),(0,r.jsx)("button",{onClick:L,className:"text-gray-400 hover:text-gray-600 text-2xl",children:"✕"})]}),(0,r.jsxs)("form",{onSubmit:F,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Categoria *"}),(0,r.jsxs)("select",{value:S.categoriaId,onChange:e=>D({...S,categoriaId:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:[(0,r.jsx)("option",{value:"",children:"Selecione uma categoria"}),d.filter(e=>"ambos"===e.tipo||e.tipo===S.tipo).map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.icone," ",e.nome]},e.id))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo *"}),(0,r.jsxs)("select",{value:S.tipo,onChange:e=>D({...S,tipo:e.target.value,categoriaId:""}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,r.jsx)("option",{value:"receita",children:"Receita"}),(0,r.jsx)("option",{value:"despesa",children:"Despesa"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor *"}),(0,r.jsx)("input",{type:"number",step:"0.01",min:"0",value:S.valor,onChange:e=>D({...S,valor:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0,00",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Descri\xe7\xe3o"}),(0,r.jsx)("input",{type:"text",value:S.descricao,onChange:e=>D({...S,descricao:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Descri\xe7\xe3o da transa\xe7\xe3o"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Frequ\xeancia *"}),(0,r.jsxs)("select",{value:S.frequencia,onChange:e=>D({...S,frequencia:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,r.jsx)("option",{value:"diario",children:"Di\xe1rio"}),(0,r.jsx)("option",{value:"semanal",children:"Semanal"}),(0,r.jsx)("option",{value:"mensal",children:"Mensal"}),(0,r.jsx)("option",{value:"anual",children:"Anual"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data de In\xedcio *"}),(0,r.jsx)("input",{type:"date",value:S.dataInicio,onChange:e=>D({...S,dataInicio:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data de Fim (opcional)"}),(0,r.jsx)("input",{type:"date",value:S.dataFim,onChange:e=>D({...S,dataFim:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),f&&(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"checkbox",id:"isActive",checked:S.isActive,onChange:e=>D({...S,isActive:e.target.checked}),className:"mr-2"}),(0,r.jsx)("label",{htmlFor:"isActive",className:"text-sm font-medium text-gray-700",children:"Transa\xe7\xe3o ativa"})]}),(0,r.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,r.jsx)("button",{type:"button",onClick:L,className:"flex-1 bg-gray-100 text-gray-700 py-3 rounded-xl hover:bg-gray-200 transition-colors font-medium",children:"Cancelar"}),(0,r.jsx)("button",{type:"submit",className:"flex-1 bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-3 rounded-xl hover:from-blue-700 hover:to-indigo-700 transition-all duration-200 font-medium",children:f?"Atualizar":"Criar"})]})]})]})})})]})})}},78657:(e,a,t)=>{Promise.resolve().then(t.bind(t,59287))}},e=>{var a=a=>e(e.s=a);e.O(0,[454,441,684,358],()=>a(78657)),_N_E=e.O()}]);