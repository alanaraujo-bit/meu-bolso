(()=>{var e={};e.id=952,e.ids=[952],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:e=>{"use strict";e.exports=require("querystring")},12412:e=>{"use strict";e.exports=require("assert")},12909:(e,r,t)=>{"use strict";t.d(r,{N:()=>n});var s=t(13581),a=t(94747),o=t(85663);let i=[{id:"1",email:"teste@teste.com",nome:"Usu\xe1rio Teste",senha:"$2b$10$g92IzJGsugx/Olm/4WqHJO3SHiJb9vqMiXSOVEfG4yD0Yy1znTN2q"},{id:"2",email:"admin@admin.com",nome:"Administrador",senha:"$2b$10$g92IzJGsugx/Olm/4WqHJO3SHiJb9vqMiXSOVEfG4yD0Yy1znTN2q"}],n={providers:[(0,s.A)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;try{let r=await a.z.usuario.findUnique({where:{email:e.email}});if(r&&await o.Ay.compare(e.password,r.senha))return{id:r.id,email:r.email,name:r.nome||""}}catch(t){console.log("⚠️ Erro de conex\xe3o com banco, usando usu\xe1rios tempor\xe1rios:",t);let r=i.find(r=>r.email===e.email);if(r&&await o.Ay.compare(e.password,r.senha))return{id:r.id,email:r.email,name:r.nome}}return null}})],session:{strategy:"jwt"},callbacks:{jwt:async({token:e,user:r})=>(r&&(e.id=r.id),e),session:async({session:e,token:r})=>(r&&(e.user.id=r.id),e)},pages:{signIn:"/login"}}},22198:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>q,routeModule:()=>p,serverHooks:()=>x,workAsyncStorage:()=>v,workUnitAsyncStorage:()=>w});var s={};t.r(s),t.d(s,{GET:()=>m,POST:()=>c});var a=t(96559),o=t(48088),i=t(37719),n=t(32190),u=t(94747),l=t(19854),d=t(12909);async function c(e){try{let r=await (0,l.getServerSession)(d.N);if(!r?.user?.email)return n.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let t=await u.z.usuario.findUnique({where:{email:r.user.email}});if(!t)return n.NextResponse.json({error:"Usu\xe1rio n\xe3o encontrado"},{status:404});let{nome:s,valorAlvo:a,dataAlvo:o}=await e.json();if(!s||!a||!o)return n.NextResponse.json({error:"Nome, valor alvo e data alvo s\xe3o obrigat\xf3rios"},{status:400});if(a<=0)return n.NextResponse.json({error:"Valor alvo deve ser maior que zero"},{status:400});let i=new Date(o+"T00:00:00"),c=new Date;if(c.setHours(0,0,0,0),i<=c)return n.NextResponse.json({error:"Data alvo deve ser no futuro"},{status:400});let m=await u.z.meta.create({data:{nome:s,valorAlvo:parseFloat(a),dataAlvo:i,currentAmount:0,isCompleted:!1,userId:t.id}});return n.NextResponse.json({...m,valorAlvo:m.valorAlvo.toNumber(),currentAmount:m.currentAmount.toNumber()},{status:201})}catch(e){return console.error("Erro ao criar meta:",e),n.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}async function m(e){try{let r=await (0,l.getServerSession)(d.N);if(!r?.user?.email)return n.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let t=await u.z.usuario.findUnique({where:{email:r.user.email}});if(!t)return n.NextResponse.json({error:"Usu\xe1rio n\xe3o encontrado"},{status:404});let{searchParams:s}=new URL(e.url),a=s.get("status"),o={userId:t.id},i=new Date;"ativas"===a?(o.isCompleted=!1,o.dataAlvo={gte:i}):"concluidas"===a?o.isCompleted=!0:"vencidas"===a&&(o.isCompleted=!1,o.dataAlvo={lt:i});let c=await u.z.meta.findMany({where:o,include:{transacoes:{select:{id:!0,valor:!0,data:!0,descricao:!0},orderBy:{data:"desc"}}},orderBy:{criadoEm:"desc"}}),m={total:await u.z.meta.count({where:{userId:t.id}}),ativas:await u.z.meta.count({where:{userId:t.id,isCompleted:!1,dataAlvo:{gte:i}}}),concluidas:await u.z.meta.count({where:{userId:t.id,isCompleted:!0}}),vencidas:await u.z.meta.count({where:{userId:t.id,isCompleted:!1,dataAlvo:{lt:i}}})};return n.NextResponse.json({metas:c.map(e=>({...e,valorAlvo:e.valorAlvo.toNumber(),currentAmount:e.currentAmount.toNumber(),transacoes:e.transacoes?.map(e=>({...e,valor:e.valor.toNumber()}))})),estatisticas:m})}catch(e){return console.error("Erro ao buscar metas:",e),n.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}let p=new a.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/metas/route",pathname:"/api/metas",filename:"route",bundlePath:"app/api/metas/route"},resolvedPagePath:"C:\\Users\\Alan Ara\xfajo\\Documents\\Meu bolso\\src\\app\\api\\metas\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:v,workUnitAsyncStorage:w,serverHooks:x}=p;function q(){return(0,i.patchFetch)({workAsyncStorage:v,workUnitAsyncStorage:w})}},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},94735:e=>{"use strict";e.exports=require("events")},94747:(e,r,t)=>{"use strict";t.d(r,{z:()=>a});let s=require("@prisma/client"),a=global.prisma||new s.PrismaClient},96487:()=>{}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[243,580,663,412],()=>t(22198));module.exports=s})();