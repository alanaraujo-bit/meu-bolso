(()=>{var e={};e.id=618,e.ids=[618],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},5792:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GET:()=>i,POST:()=>i,authOptions:()=>s.N});var a=t(19854),o=t.n(a),s=t(12909);let i=o()(s.N)},6747:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>h,routeModule:()=>m,serverHooks:()=>v,workAsyncStorage:()=>p,workUnitAsyncStorage:()=>g});var a={};t.r(a),t.d(a,{GET:()=>d});var o=t(96559),s=t(48088),i=t(37719),n=t(32190),u=t(19854),l=t(5792),c=t(94747);async function d(e){try{let r=await (0,u.getServerSession)(l.authOptions);if(!r?.user?.email)return n.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let{searchParams:t}=new URL(e.url),a=t.get("mes"),o=t.get("ano"),s=new Date,i=a?parseInt(a):s.getMonth()+1,d=o?parseInt(o):s.getFullYear(),m=await c.z.usuario.findUnique({where:{email:r.user.email}});if(!m)return n.NextResponse.json({error:"Usu\xe1rio n\xe3o encontrado"},{status:404});let p=new Date(d,i-1,1),g=new Date(d,i,0,23,59,59),v=new Date(d,i-2,1),h=new Date(d,i-1,0,23,59,59),f=await c.z.transacao.findMany({where:{userId:m.id,data:{gte:p,lte:g}},include:{categoria:!0},orderBy:{data:"desc"}}),x=await c.z.transacao.findMany({where:{userId:m.id,data:{gte:v,lte:h}}}),w=await c.z.categoria.findMany({where:{userId:m.id}}),b=await c.z.meta.findMany({where:{userId:m.id}}),y=f.filter(e=>"receita"===e.tipo).reduce((e,r)=>e+Number(r.valor),0),N=f.filter(e=>"despesa"===e.tipo).reduce((e,r)=>e+Number(r.valor),0),q=y-N,A=x.filter(e=>"receita"===e.tipo).reduce((e,r)=>e+Number(r.valor),0),z=x.filter(e=>"despesa"===e.tipo).reduce((e,r)=>e+Number(r.valor),0),S=A>0?(y-A)/A*100:0,C=z>0?(N-z)/z*100:0,M=N/s.getDate(),E=y>0?q/y*100:0,D=f.filter(e=>"despesa"===e.tipo).sort((e,r)=>Number(r.valor)-Number(e.valor))[0],R=f.filter(e=>"despesa"===e.tipo).reduce((e,r)=>{let t=r.categoria?.nome||"Sem categoria",a=e.find(e=>e.categoria===t);return a?(a.valor+=Number(r.valor),a.transacoes+=1):e.push({categoria:t,valor:Number(r.valor),cor:r.categoria?.cor||"#EF4444",transacoes:1}),e},[]),j=R.sort((e,r)=>r.valor-e.valor)[0],I=f.filter(e=>"receita"===e.tipo).reduce((e,r)=>{let t=r.categoria?.nome||"Sem categoria",a=e.find(e=>e.categoria===t);return a?a.valor+=Number(r.valor):e.push({categoria:t,valor:Number(r.valor),cor:r.categoria?.cor||"#10B981"}),e},[]),$=[];for(let e=5;e>=0;e--){let r=new Date(d,i-1-e,1),t=new Date(d,i-e,0,23,59,59),a=await c.z.transacao.findMany({where:{userId:m.id,data:{gte:r,lte:t}}}),o=a.filter(e=>"receita"===e.tipo).reduce((e,r)=>e+Number(r.valor),0),s=a.filter(e=>"despesa"===e.tipo).reduce((e,r)=>e+Number(r.valor),0);$.push({mes:r.toLocaleDateString("pt-BR",{month:"short"}),receitas:o,despesas:s,saldo:o-s})}let O=b.map(e=>{let r=Number(e.valorAlvo)>0?Number(e.currentAmount)/Number(e.valorAlvo)*100:0;return{id:e.id,nome:e.nome,valorAlvo:Number(e.valorAlvo),currentAmount:Number(e.currentAmount),progresso:r,dataAlvo:e.dataAlvo.toISOString(),isCompleted:e.isCompleted}}),G=O.filter(e=>!e.isCompleted),P=O.filter(e=>e.isCompleted),k=G.filter(e=>new Date(e.dataAlvo)<new Date),F=[];return D&&F.push({tipo:"info",titulo:"Maior Gasto do M\xeas",descricao:`${D.descricao} - ${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(Number(D.valor))}`,icone:"\uD83D\uDCB8"}),j&&F.push({tipo:"info",titulo:"Categoria Mais Gasta",descricao:`${j.categoria} - ${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(j.valor)}`,icone:"\uD83D\uDCCA"}),C>10&&F.push({tipo:"alerta",titulo:"Aumento nos Gastos",descricao:`Seus gastos aumentaram ${C.toFixed(1)}% em rela\xe7\xe3o ao m\xeas anterior`,icone:"⚠️"}),E>20?F.push({tipo:"sucesso",titulo:"Excelente Economia!",descricao:`Voc\xea est\xe1 economizando ${E.toFixed(1)}% da sua renda`,icone:"\uD83C\uDF89"}):E<5&&y>0&&F.push({tipo:"dica",titulo:"Melhore sua Economia",descricao:`Tente economizar mais. Sua taxa atual \xe9 de ${E.toFixed(1)}%`,icone:"\uD83D\uDCA1"}),n.NextResponse.json({periodo:{mes:i,ano:d},resumo:{totalReceitas:y,totalDespesas:N,saldo:q,economias:q>0?q:0,transacoesCount:f.length,categoriasCount:w.length,receitasCount:f.filter(e=>"receita"===e.tipo).length,despesasCount:f.filter(e=>"despesa"===e.tipo).length,totalEconomizado:P.reduce((e,r)=>e+r.currentAmount,0),metasAtivas:G.length,metasConcluidas:P.length,variacaoReceitas:S,variacaoDespesas:C,taxaEconomia:E,mediaGastoDiario:M,maiorGasto:D?{descricao:D.descricao,valor:Number(D.valor),categoria:D.categoria?.nome||"Sem categoria"}:null},graficos:{receitasPorCategoria:I,gastosPorCategoria:R,evolucaoMensal:$,comparacaoMensal:{atual:{receitas:y,despesas:N,saldo:q},anterior:{receitas:A,despesas:z,saldo:A-z}}},metas:{ativas:G,concluidas:P,vencidas:k,resumo:{total:O.length,ativas:G.length,concluidas:P.length,vencidas:k.length,totalEconomizado:P.reduce((e,r)=>e+r.currentAmount,0)}},insights:F})}catch(e){return console.error("Erro no dashboard:",e),n.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}let m=new o.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/dashboard/route",pathname:"/api/dashboard",filename:"route",bundlePath:"app/api/dashboard/route"},resolvedPagePath:"C:\\Users\\Alan Ara\xfajo\\Documents\\Meu bolso\\src\\app\\api\\dashboard\\route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:p,workUnitAsyncStorage:g,serverHooks:v}=m;function h(){return(0,i.patchFetch)({workAsyncStorage:p,workUnitAsyncStorage:g})}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:e=>{"use strict";e.exports=require("querystring")},12412:e=>{"use strict";e.exports=require("assert")},12909:(e,r,t)=>{"use strict";t.d(r,{N:()=>n});var a=t(13581),o=t(94747),s=t(85663);let i=[{id:"1",email:"teste@teste.com",nome:"Usu\xe1rio Teste",senha:"$2b$10$g92IzJGsugx/Olm/4WqHJO3SHiJb9vqMiXSOVEfG4yD0Yy1znTN2q"},{id:"2",email:"admin@admin.com",nome:"Administrador",senha:"$2b$10$g92IzJGsugx/Olm/4WqHJO3SHiJb9vqMiXSOVEfG4yD0Yy1znTN2q"}],n={providers:[(0,a.A)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;try{let r=await o.z.usuario.findUnique({where:{email:e.email}});if(r&&await s.Ay.compare(e.password,r.senha))return{id:r.id,email:r.email,name:r.nome||""}}catch(t){console.log("⚠️ Erro de conex\xe3o com banco, usando usu\xe1rios tempor\xe1rios:",t);let r=i.find(r=>r.email===e.email);if(r&&await s.Ay.compare(e.password,r.senha))return{id:r.id,email:r.email,name:r.nome}}return null}})],session:{strategy:"jwt"},callbacks:{jwt:async({token:e,user:r})=>(r&&(e.id=r.id),e),session:async({session:e,token:r})=>(r&&(e.user.id=r.id),e)},pages:{signIn:"/login"}}},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},94735:e=>{"use strict";e.exports=require("events")},94747:(e,r,t)=>{"use strict";t.d(r,{z:()=>o});let a=require("@prisma/client"),o=global.prisma||new a.PrismaClient},96487:()=>{}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[243,580,663,412],()=>t(6747));module.exports=a})();