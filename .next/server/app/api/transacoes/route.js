(()=>{var e={};e.id=151,e.ids=[151],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:e=>{"use strict";e.exports=require("querystring")},12412:e=>{"use strict";e.exports=require("assert")},12909:(e,r,t)=>{"use strict";t.d(r,{N:()=>n});var a=t(13581),s=t(94747),o=t(85663);let i=[{id:"1",email:"teste@teste.com",nome:"Usu\xe1rio Teste",senha:"$2b$10$g92IzJGsugx/Olm/4WqHJO3SHiJb9vqMiXSOVEfG4yD0Yy1znTN2q"},{id:"2",email:"admin@admin.com",nome:"Administrador",senha:"$2b$10$g92IzJGsugx/Olm/4WqHJO3SHiJb9vqMiXSOVEfG4yD0Yy1znTN2q"}],n={providers:[(0,a.A)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;try{let r=await s.z.usuario.findUnique({where:{email:e.email}});if(r&&await o.Ay.compare(e.password,r.senha))return{id:r.id,email:r.email,name:r.nome||""}}catch(t){console.log("⚠️ Erro de conex\xe3o com banco, usando usu\xe1rios tempor\xe1rios:",t);let r=i.find(r=>r.email===e.email);if(r&&await o.Ay.compare(e.password,r.senha))return{id:r.id,email:r.email,name:r.nome}}return null}})],session:{strategy:"jwt"},callbacks:{jwt:async({token:e,user:r})=>(r&&(e.id=r.id),e),session:async({session:e,token:r})=>(r&&(e.user.id=r.id),e)},pages:{signIn:"/login"}}},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},89051:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>f,routeModule:()=>g,serverHooks:()=>w,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>x});var a={};t.r(a),t.d(a,{GET:()=>p,POST:()=>d});var s=t(96559),o=t(48088),i=t(37719),n=t(32190),l=t(94747),u=t(19854),c=t(12909);async function d(e){try{let r=await (0,u.getServerSession)(c.N);if(!r?.user?.email)return n.NextResponse.json({error:"N\xe3o autorizado"},{status:401});let{valor:t,tipo:a,categoriaId:s,data:o,descricao:i,tags:d}=await e.json();if(!t||!a||!o)return n.NextResponse.json({error:"Dados obrigat\xf3rios n\xe3o fornecidos"},{status:400});let p=await l.z.usuario.findUnique({where:{email:r.user.email}});if(!p)return n.NextResponse.json({error:"Usu\xe1rio n\xe3o encontrado"},{status:404});let g=await l.z.categoria.findFirst({where:{id:s,userId:p.id}});if(!g)return n.NextResponse.json({error:"Categoria n\xe3o encontrada"},{status:404});if("ambos"!==g.tipo&&g.tipo!==a)return n.NextResponse.json({error:`Esta categoria s\xf3 aceita transa\xe7\xf5es do tipo: ${g.tipo}`},{status:400});let m=await l.z.transacao.create({data:{userId:p.id,categoriaId:s||null,tipo:a,valor:parseFloat(t),data:new Date(o+"T00:00:00"),descricao:i||null,tags:Array.isArray(d)?d:[],anexos:[],isRecorrente:!1},include:{categoria:!0}});return n.NextResponse.json({...m,valor:m.valor.toNumber()})}catch(e){return console.error("Erro ao criar transa\xe7\xe3o:",e),n.NextResponse.json({error:"Erro interno do servidor"},{status:500})}}async function p(e){try{console.log("\uD83D\uDD0D Iniciando busca de transa\xe7\xf5es...");let r=await (0,u.getServerSession)(c.N);if(!r?.user?.email)return n.NextResponse.json({error:"N\xe3o autorizado"},{status:401});console.log("\uD83D\uDC64 Usu\xe1rio autenticado:",r.user.email);let t=await l.z.usuario.findUnique({where:{email:r.user.email}});if(!t)return n.NextResponse.json({error:"Usu\xe1rio n\xe3o encontrado"},{status:404});console.log("✅ Usu\xe1rio encontrado:",t.id);let a=await l.z.categoria.findMany({where:{userId:t.id}});console.log("\uD83D\uDCC2 Categorias encontradas:",a.length);let{searchParams:s}=new URL(e.url),o=s.get("tipo"),i=s.get("categoriaId"),d=s.get("dataInicio"),p=s.get("dataFim"),g=s.get("busca"),m=s.get("valorMin"),x=s.get("valorMax"),w=parseInt(s.get("pagina")||"1"),f=parseInt(s.get("limite")||"10"),v=(w-1)*f,y=s.get("ordenarPor")||"data",h=s.get("direcao")||"desc";console.log("\uD83D\uDD27 Par\xe2metros:",{tipo:o,categoriaId:i,dataInicio:d,dataFim:p,busca:g,valorMin:m,valorMax:x,pagina:w,limite:f,ordenarPor:y,direcao:h});let q={userId:t.id};o&&("receita"===o||"despesa"===o)&&(q.tipo=o),i&&(q.categoriaId=i),d&&(q.data={...q.data,gte:new Date(d)}),p&&(q.data={...q.data,lte:new Date(p)}),g&&(q.descricao={contains:g}),m&&(q.valor={...q.valor,gte:parseFloat(m)}),x&&(q.valor={...q.valor,lte:parseFloat(x)}),console.log("\uD83D\uDD0D Filtros constru\xeddos:",JSON.stringify(q,null,2));let b={};"categoria"===y?b.categoria={nome:h}:b[y]=h,console.log("\uD83D\uDCCA Ordena\xe7\xe3o:",b),console.log("\uD83D\uDD22 Contando transa\xe7\xf5es...");let N=await l.z.transacao.count({where:q}),j=Math.ceil(N/f);console.log("\uD83D\uDCCA Total de transa\xe7\xf5es:",N),console.log("\uD83D\uDCCB Buscando transa\xe7\xf5es...");let R=await l.z.transacao.findMany({where:q,include:{categoria:!0},orderBy:b,skip:v,take:f});console.log("✅ Transa\xe7\xf5es encontradas:",R.length),console.log("\uD83D\uDCB0 Calculando totais...");let z=await l.z.transacao.findMany({where:q,select:{tipo:!0,valor:!0}}),I=z.filter(e=>"receita"===e.tipo).reduce((e,r)=>e+r.valor.toNumber(),0),A=z.filter(e=>"despesa"===e.tipo).reduce((e,r)=>e+r.valor.toNumber(),0),E=I-A;console.log("\uD83D\uDCB0 Resumo financeiro:",{totalReceitas:I,totalDespesas:A,saldo:E});let S={transacoes:R.map(e=>({...e,valor:e.valor.toNumber()})),resumo:{totalReceitas:I,totalDespesas:A,saldo:E,totalTransacoes:z.length},categorias:a,paginacao:{paginaAtual:w,totalPaginas:j,total:N,limite:f},totalPaginas:j,total:N};return console.log("✅ Retornando resultado com",S.transacoes.length,"transa\xe7\xf5es"),n.NextResponse.json(S)}catch(e){return console.error("❌ Erro ao buscar transa\xe7\xf5es:",e),n.NextResponse.json({error:"Erro interno do servidor",details:e instanceof Error?e.message:"Erro desconhecido"},{status:500})}}let g=new s.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/transacoes/route",pathname:"/api/transacoes",filename:"route",bundlePath:"app/api/transacoes/route"},resolvedPagePath:"C:\\Users\\Alan Ara\xfajo\\Documents\\Meu bolso\\src\\app\\api\\transacoes\\route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:m,workUnitAsyncStorage:x,serverHooks:w}=g;function f(){return(0,i.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:x})}},94735:e=>{"use strict";e.exports=require("events")},94747:(e,r,t)=>{"use strict";t.d(r,{z:()=>s});let a=require("@prisma/client"),s=global.prisma||new a.PrismaClient},96487:()=>{}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[243,580,663,412],()=>t(89051));module.exports=a})();